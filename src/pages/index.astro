---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import Calendar from "../components/Calendar.astro";
import HomeArticleBlock from "../components/HomeArticleBlock.astro";
import news from "../data/news.json";
import notices from "../data/notices.json";
import schedules from "../data/schedules.json";
import memorials from "../data/memorials.json";
import NoticeList from "../components/NoticeList.astro";

function isNoteLike(data: { kind?: string }) {
  return data.kind === "note";
}

const postsAll = await getCollection(
  "posts",
  ({ data }) => !data.draft && !isNoteLike(data)
);
const posts = postsAll.sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
---
<BaseLayout title="かもねぎ通信">
  <div class="homeGrid">
    <main class="homeCol">
      <section class="homeSection">
        <HomeArticleBlock posts={posts} limit={10} />
      </section>

      <section class="homeSection">
        <Calendar posts={posts} memorials={memorials} />
      </section>
    </main>

    <aside class="homeCol homeAside">
      <section class="homeSection">
        <NoticeList notices={news} title="ニュース" limit={8} recentDays={7} />
      </section>

      <section class="homeSection">
        <NoticeList notices={notices} title="お知らせ" limit={8} recentDays={7} />
      </section>

      <section class="homeSection">
        <NoticeList notices={schedules} title="予定" limit={8} />
      </section>
    </aside>
  </div>

  <style>
    .homeGrid {
      display: grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(280px, 0.75fr);
      gap: 26px;
      align-items: start;
      justify-content: center;
    }

    .homeCol {
      display: grid;
      gap: 16px;
      align-content: start;
      min-width: 0;
    }

    .homeAside {
      padding-left: 0;
      border-left: 0;
    }

    .homeSection {
      padding: 0;
      margin: 0;
    }

    @media (max-width: 900px) {
      .homeGrid {
        grid-template-columns: 1fr;
        gap: 18px;
      }
      .homeAside {
        padding-left: 0;
        border-left: 0;
        border-top: 0;
        padding-top: 0;
      }
    }

  </style>
</BaseLayout>
