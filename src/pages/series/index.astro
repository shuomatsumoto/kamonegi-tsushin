---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import ListIndexHeader from "../../components/ListIndexHeader.astro";

const BASE = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : import.meta.env.BASE_URL + "/";

const posts = await getCollection("posts", ({ data }) => !data.draft);

const map = new Map<string, number>();
for (const p of posts) {
  const s = p.data.series?.trim();
  if (!s) continue;
  map.set(s, (map.get(s) ?? 0) + 1);
}

const seriesList = Array.from(map.entries())
  .sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0], "ja"));
---

<BaseLayout title="連載 | かもねぎ通信">
  <ListIndexHeader title="連載" countLabel={`${seriesList.length} series`} />

  <div class="hr"></div>

  {seriesList.length ? (
    <ul class="seriesList">
      {seriesList.map(([s, n]) => (
        <li>
          <a class="seriesRow" href={`${BASE}series/${encodeURIComponent(s)}`}>
            <span class="seriesName">{s}</span>
            <span class="count">{n}</span>
          </a>
        </li>
      ))}
    </ul>
  ) : (
    <div class="small">まだ連載はありません。</div>
  )}
</BaseLayout>

<style>
  .seriesList { list-style:none; padding:0; margin:0; }
  .seriesRow {
    display:flex; justify-content:space-between; gap:12px;
    padding:8px 0; border-bottom:1px dotted var(--line);
    text-decoration:none; color:var(--ink);
  }
  .seriesRow:hover { opacity:0.75; }
  .seriesName { color: var(--ink); }
  .count { color: var(--muted); font-size:0.9em; }
</style>
