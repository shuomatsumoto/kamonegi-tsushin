---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import ArticleList from "../../components/ArticleList.astro";

const BASE = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : import.meta.env.BASE_URL + "/";

export async function getStaticPaths() {
  const posts = await getCollection("posts", ({ data }) => !data.draft);
  const series = new Set<string>();
  for (const p of posts) {
    const s = p.data.series?.trim();
    if (s) series.add(s);
  }
  return Array.from(series).map((s) => ({ params: { series: s } }));
}

const series = decodeURIComponent((Astro.params.series ?? "") as string);

const posts = await getCollection("posts", ({ data }) =>
  !data.draft && (data.series?.trim() ?? "") === series
);

posts.sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
---

<BaseLayout title={`${series} | かもねぎ通信`}>
  <div style="display:flex; align-items:baseline; justify-content:space-between; gap:12px;">
    <h2 class="h2" style="margin:0;">{series}</h2>
    <a class="small mono" href={`${BASE}series`} style="text-decoration:none;">連載一覧</a>
  </div>

  <div class="hr"></div>

  <ArticleList posts={posts} title="" />
</BaseLayout>

<style>
  a:hover { opacity: 0.75; }
</style>
