---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const BASE = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : import.meta.env.BASE_URL + "/";

const posts = await getCollection("posts", ({ data }) => !data.draft);

// タグ -> 件数
const map = new Map<string, number>();
for (const p of posts) {
  for (const t of p.data.tags ?? []) {
    map.set(t, (map.get(t) ?? 0) + 1);
  }
}

const tags = Array.from(map.entries())
  .sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0], "ja"));
---

<BaseLayout title="タグ | かもねぎ通信">
  <div style="display:flex; align-items:baseline; justify-content:space-between; gap:12px;">
    <h2 class="h2" style="margin:0;">タグ</h2>
    <div class="small mono">{tags.length} tags</div>
  </div>

  <div class="hr"></div>

  <ul class="tagList">
    {tags.map(([t, n]) => (
      <li>
        <a class="tagRow" href={`${BASE}tags/${encodeURIComponent(t)}`}>
          <span class="tag">#{t}</span>
          <span class="count">{n}</span>
        </a>
      </li>
    ))}
  </ul>
</BaseLayout>

<style>
  .tagList { list-style:none; padding:0; margin:0; }
  .tagRow {
    display:flex; justify-content:space-between; gap:12px;
    padding:8px 0; border-bottom:1px dotted var(--line);
    text-decoration:none; color:var(--ink);
  }
  .tagRow:hover { opacity:0.75; }
  .tag { color: var(--ink); }
  .count { color: var(--muted); font-size:0.9em; }
</style>