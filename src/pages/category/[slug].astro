---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import ArticleList from "../../components/ArticleList.astro";

const BASE = import.meta.env.BASE_URL.endsWith("/")
  ? import.meta.env.BASE_URL
  : import.meta.env.BASE_URL + "/";

export async function getStaticPaths() {
  const posts = await getCollection("posts", ({ data }) => !data.draft);
  const categories = Array.from(new Set(posts.map((p) => p.data.category)));
  return categories.map((category) => ({
    params: { slug: category },
    props: { category },
  }));
}

const { category } = Astro.props as { category: string };

const postsAll = await getCollection(
  "posts",
  ({ data }) => !data.draft && data.category === category
);

const posts = postsAll.sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
---
<BaseLayout title={`${category} | かもねぎ通信`}>
  <div style="display:flex; align-items:baseline; justify-content:space-between; gap:12px;">
    <h2 class="h2" style="margin:0;">{category}</h2>
    <a class="small" href={`${BASE}category`} style="text-decoration:none; color:var(--muted);">カテゴリ一覧</a>
  </div>

  <div class="hr"></div>

  <ArticleList posts={posts} title="記事一覧" />
</BaseLayout>
